<div class="main-container-inner" ng-app="MyApp" ng-controller="TaskController" id="TaskController" style="">
  #parse("deploy/sidebar.htm")
  <div class="main-content" style="display: none">
    #parse("deploy/breadcrumb.htm")
    <div class="page-content">
      <div class="page-header">
        <span class="label label-lg label-info arrowed-right">任务ID</span><span class="label label-lg  arrowed-in">{{task.task.id}}</span> &nbsp;&nbsp; &nbsp;
          <span class="label label-lg label-info arrowed-right">任务名称</span><span class="label label-lg arrowed-in">{{task.task.name}}</span> &nbsp;&nbsp; &nbsp; 
          <span class="label label-lg label-info arrowed-right">任务状态</span><span class="label label-lg label-pink arrowed-in">{{task.task.status}}</span>
        <button style="float: right; margin-bottom: 10px; margin-right: 0px;" type="button"
          ng-click="updateAndStartTask()" ng-show="task.task.stateAction==null || task.task.stateAction=='STOP'"
          class="btn btn-primary btn-sm">启动任务</button>
        <button type="button" style="float: right; margin-bottom: 10px; margin-right: 0px" ng-click="stopTask()"
          class="btn btn-danger btn-sm" ng-show="task.task.stateAction=='START'">停止任务</button>
        <button type="button" style="float: right; margin-bottom: 10px; margin-right: 0px" ng-click="startTask()"
          class="btn btn-danger btn-sm" ng-show="task.task.stateAction=='PAUSE'">继续运行</button>
        <span class="label" ng-show="task.task.stateAction" style="float: right; margin-top: 8px; margin-right: 20px;">运行状态：
          {{ task.task.stateAction }}</span>
      </div>
      <div class="row">
        <div id="alertMessageDiv" style="text-align: center;"></div>
        <div class="col-xs-12">
          <div class="row">
            <div class="col-sm-6">
              <div ng-repeat="deployVsBo in task.deployVsBos">
                <table style="margin-bottom: 5px;"
                  class="table table-bordered table-condensed nohover">
                  <thead ng-click="showVsLog(deployVsBo)">
                    <tr>
                      <th width="70">站点名称</th>
                      <td width="140">{{ deployVsBo.deployVs.vsName }}</td>
                      <th width="70">发布版本</th>
                      <td width="140">{{ deployVsBo.deployVs.vsTag }}</td>
                      <th width="40">状态</th>
                      <td width="70">{{ deployVsBo.deployVs.status }}</td>
                    </tr>
                  </thead>
                </table>
                <table style="margin-top: 0px;" class="slb-datatable table table-bordered table-condensed lion">
                  <thead>
                    <tr>
                      <th width="20px"><input ng-disabled="!canUpdate" type="checkbox"
                        ng-click="checkAllIp(deployVsBo,$event)"
                        ng-checked="isContainAll(deployVsBo.deployAgentBos,deployVsBo.vs.instances)" /></th>
                      <th>IP</th>
                      <th>状态</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-init="deployAgentBo = getAgent(deployVsBo.deployAgentBos,instance.ip)"
                      ng-click="showAgentLog(deployAgentBo)" ng-repeat="instance in deployVsBo.vs.instances"
                      class="my-progress-bar">
                      <td width="20px"><input ng-disabled="!canUpdate" type="checkbox"
                        ng-click="checkIp(deployVsBo.deployAgentBos,instance.ip)"
                        ng-checked="isContain(deployVsBo.deployAgentBos,instance.ip)"></td>
                      <td ng-click="checkIp(deployVsBo.deployAgentBos,instance.ip)">{{instance.ip}}</td>
                      <td style="width: 200px; padding-right: 10px;" ng-switch="deployAgentBo.deployAgent.status">
                        <div ng-switch-when="CREATED" class="progress">
                          <div style="width: 0%" class="progress-bar"></div>
                          <p style="left: 40%;">未开始</p>
                        </div>
                        <div ng-switch-when="PROCESSING" class="progress">
                          <div style="width: {{deployAgentBo.processPct" class="progress-bar progress-bar-primary"></div>
                          <p style="left: 35%;">正在发布</p>
                        </div>
                        <div ng-switch-when="SUCCESS" class="progress">
                          <div style="width: 100%" class="progress-bar progress-bar-success"></div>
                          <p style="left: 40%;">成功</p>
                        </div>
                        <div ng-switch-when="REJECTED" class="progress">
                          <div style="width: 100%" class="progress-bar progress-bar-danger"></div>
                          <p style="left: 30%;">失败(被拒绝)</p>
                        </div>
                        <div ng-switch-when="FAILED" class="progress">
                          <div style="width: 100%" class="progress-bar progress-bar-danger"></div>
                          <p style="left: 40%;">失败</p>
                        </div>
                        <div ng-switch-when="CANCELLED" class="progress">
                          <div style="width: 100%" class="progress-bar progress-bar-danger"></div>
                          <p style="left: 38%;">被取消</p>
                        </div>
                        <div ng-switch-default></div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="row">
                <div class="span12 thumbnail">
                  <form class="form-inline">
                    <table class="table table-condensed lion nohover"
                      style="margin: 0 0 0; border-bottom: 1px solid #DDD;">
                      <thead>
                        <tr>
                          <th colspan="3"><label class="help-inline" style="padding-left: 0px;"><strong
                              style="color: #08C;">部署方式</strong></label></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td width="190"><label class="radio"><input ng-disabled="!canUpdate" type="radio"
                              ng-model="task.task.agentBatch" value="ONE_BY_ONE"> 1->1->1 (每次一台)</label></td>
                          <td width="190"><label class="radio"><input ng-disabled="!canUpdate" type="radio"
                              ng-model="task.task.agentBatch" value="TWO_BY_TWO"> 1->2->2 (每次两台) </label></td>
                          <td width="190"><label class="radio"><input ng-disabled="!canUpdate" type="radio"
                              ng-model="task.task.agentBatch" value="THREE_BY_THREE"> 1->3->3 (每次三台) </label></td>
                        </tr>
                      </tbody>
                    </table>
                    <table class="table table-condensed lion nohover"
                      style="margin: 0 0 0; border-bottom: 1px solid #DDD;">
                      <thead>
                        <tr>
                          <th colspan="3"><label class="help-inline" style="padding-left: 0px;"><strong
                              style="color: #08C;">错误处理</strong></label></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td width="180"><label class="radio"><input ng-disabled="!canUpdate" type="radio"
                              ng-model="task.task.errorPolicy" value="FALL_THROUGH"> 跳过错误 </label></td>
                          <td><label class="radio"><input ng-disabled="!canUpdate" type="radio"
                              ng-model="task.task.errorPolicy" value="ABORT_ON_ERROR"> 中断发布</label></td>
                        </tr>
                      </tbody>
                    </table>
                    <table class="table table-condensed lion nohover"
                      style="margin: 0 0 0; border-bottom: 1px solid #DDD;">
                      <thead>
                        <tr>
                          <th colspan="3"><label class="help-inline" style="padding-left: 0px;"><strong
                              style="color: #08C;">发布控制</strong></label></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td width="180"><label class="radio"><input ng-disabled="!canUpdate"
                              ng:model="task.task.autoContinue" boolean-value="false" type="radio"> 手动控制</label></td>
                          <td><label class="radio"><input ng-disabled="!canUpdate" type="radio"
                              ng:model="task.task.autoContinue" boolean-value="true"> 发布间隔/秒: </label> <input
                            ng-disabled="!canUpdate" type="text" class="input-sm"
                            ng-model="task.task.deployInterval" ng-disabled="task.task.autoContinue=='false'"></td>
                        </tr>
                      </tbody>
                    </table>
                  </form>
                </div>
              </div>
              <pre
                style="cursor: text; margin-top: 20px; background-color: #3A1042; color: #FFFFFF; font-size: 12px; width: 100%; height: 420px; overflow-x: auto;"
                id="console"></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  #parse("deploy/modals.htm")
</div>